<!doctype html>
<html>
  <head>
    <title>griddly • all at once</title>
    <script src="//code.jquery.com/jquery-1.11.0.js"></script>
    <script src="https://rawgithub.com/carhartl/jquery-cookie/master/jquery.cookie.js"></script>
    
    <link rel="stylesheet" href="style.css">
    
    <script src="http://gridster.net/dist/jquery.gridster.js"></script>
    <link rel="stylesheet" href="http://gridster.net/dist/jquery.gridster.css">
  </head>
  <body>
    <div id="grid">
      <ul>
        <!--<li data-row="1" data-col="1" data-sizex="1" data-sizey="1">
          Welcome to Griddly!
        </li>
        <li data-row="2" data-col="1" data-sizex="1" data-sizey="3">
          Second Box
        </li>-->
      </ul>
    </div>
  <script type="text/javascript">
    var grid;
  
    $(function(){ //DOM loaded
      grid = $("#grid ul").gridster().data('gridster');
      if(!$.cookie("grid-layout")){
        firstTimeInit();
      }
      loadLayout();
      saveLayout();
    });
    
    function render(){
      $("#grid ul").gridster({
        widget_margins: [10, 10],
        widget_base_dimensions: [140, 140],
        draggable: {
          handle: '.drag-handle'
        }
      });
      $("li").css("position","absolute");
      addHandles();
      
      $(".content > iframe").parent().css("padding","0px");
      $(".content > iframe").attr("seamless","seamless").attr("width","100%").attr("height",$(".content > iframe").parent().parent().outerHeight()-10);
    }
    
    function saveLayout(){
      $.cookie("grid-layout", JSON.stringify(grid.serialize()));
      
      var content = $(".content").map(function(){return $(this).html();}).get().join('Ꮻ');
      $.cookie("grid-content", content);
    }
    
    function loadLayout(){
      grid.remove_all_widgets();
      var layout = JSON.parse($.cookie("grid-layout"));
      var content = $.cookie("grid-content").split("Ꮻ");
      
      $.each(layout, function(i) {
        grid.add_widget('<li><div class="content">'+content[i]+'</div></li>', this.size_x, this.size_y, this.col, this.row);
      });
      
      render();
    }
    
    function addHandles(){
      $(".drag-handle").remove();
      $("li").prepend('<div class="drag-handle" align="center"></div>');
    }
    
    function firstTimeInit(){
      grid.add_widget('<li><div class="content">Welcome to Griddly!</div></li>', 2, 2, 2, 1);
      saveLayout();
      render();
    }
  </script>
  </body>
</html>
